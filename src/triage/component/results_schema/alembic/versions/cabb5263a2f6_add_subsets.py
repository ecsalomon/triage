"""empty message

Revision ID: cabb5263a2f6
Revises: 38f37d013686
Create Date: 2019-01-18 11:06:02.652626

"""
from alembic import op
import sqlalchemy as sa
from sqlalchemy.dialects import postgresql

# revision identifiers, used by Alembic.
revision = "cabb5263a2f6"
down_revision = "38f37d013686"
branch_labels = None
depends_on = None


def upgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table(
        "subsets",
        sa.Column("subset_hash", sa.String(), nullable=False),
        sa.Column("config", postgresql.JSONB(astext_type=sa.Text()), nullable=True),
        sa.Column("created_timestamp", sa.DateTime(timezone=True), server_default=sa.text("now()"), nullable=True),
        sa.PrimaryKeyConstraint("subset_hash"),
        schema="model_metadata",
    )
    op.add_column("evaluations", sa.Column("subset_hash", sa.String(), nullable=False, server_default=""), schema="test_results")
    op.drop_constraint("evaluations_pkey", "evaluations", schema="test_results")
    op.create_primary_key(
        name="evaluations_pkey",
        table_name="evaluations",
        columns=["model_id", "subset_hash", "evaluation_start_time", "evaluation_end_time", "as_of_date_frequency", "metric", "parameter"],
        schema="test_results",
    )
    op.add_column("evaluations", sa.Column("subset_hash", sa.String(), nullable=False, server_default=""), schema="train_results")
    op.drop_constraint("train_evaluations_pkey", "evaluations", schema="train_results")
    op.create_primary_key(
        name="train_evaluations_pkey",
        table_name="evaluations",
        columns=["model_id", "subset_hash", "evaluation_start_time", "evaluation_end_time", "as_of_date_frequency", "metric", "parameter"],
        schema="train_results",
    )
    # ### end Alembic commands ###


def downgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_constraint("evaluations_pkey", "evaluations", schema="test_results")
    op.create_primary_key(
        name="evaluations_pkey",
        table_name="evaluations",
        columns=["model_id", "evaluation_start_time", "evaluation_end_time", "as_of_date_frequency", "metric", "parameter"],
        schema="test_results",
    )
    op.drop_constraint("train_evaluations_pkey", "evaluations", schema="train_results")
    op.create_primary_key(
        name="train_evaluations_pkey",
        table_name="evaluations",
        columns=["model_id", "evaluation_start_time", "evaluation_end_time", "as_of_date_frequency", "metric", "parameter"],
        schema="train_results",
    )
    op.drop_column("evaluations", "subset_hash", schema="train_results")
    op.drop_column("evaluations", "subset_hash", schema="test_results")
    op.drop_table("subsets", schema="model_metadata")
    # ### end Alembic commands ###
